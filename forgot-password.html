<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ลืมรหัสผ่าน - VG SHOP</title>
        <link rel="stylesheet" href="styles.css">
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
        <script type="text/javascript">
            (function(){
                emailjs.init("ec8yJSGmW3AwGLnR4"); // Public Key เดิมของคุณ
            })();
        </script>
    </head>
    <body>
        <section class="login-section">
            <div class="login-card">
                <h2>ลืมรหัสผ่าน</h2>
                <p class="sub-text">ระบุอีเมลที่คุณใช้สมัครสมาชิกเพื่อรับลิงก์เปลี่ยนรหัสผ่าน</p>
                
                <form id="forgotForm">
                    <div class="form-group">
                        <label for="email">อีเมลของคุณ</label>
                        <input type="email" id="email" class="form-input" placeholder="example@email.com" required>
                    </div>
                    <button type="submit" class="btn-login">ส่งลิงก์เปลี่ยนรหัสผ่าน</button>
                </form>
                <br>
                <a href="sign.html" style="text-decoration: none; color: #666;">กลับไปหน้าเข้าสู่ระบบ</a>
            </div>
        </section>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

            // ... config ของคุณ ...

            document.getElementById('forgotForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;

                // ** ส่วนสำคัญ: กำหนดว่าเปลี่ยนรหัสเสร็จให้ไปไหน **
                const actionCodeSettings = {
                    url: 'https://arcana2546.github.io/vg-shop/reset-password.html', // ลิงก์หน้าเว็บคุณ
                    handleCodeInApp: true
                };

                try {
                    await sendPasswordResetEmail(auth, email, actionCodeSettings);
                    alert("Firebase ได้ส่งลิงก์ไปแล้ว! เมื่อคุณคลิกลิงก์ในเมล มันจะพาคุณกลับมาที่หน้า reset-password ของเราครับ");
                } catch (error) {
                    alert(error.message);
                }
            });
        </script>
    </body>
</html>

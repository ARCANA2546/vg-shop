<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตั้งรหัสผ่านใหม่ - VG SHOP</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <section class="login-section">
        <div class="login-card" style="max-width: 450px;">
            <h2>ตั้งรหัสผ่านใหม่</h2>
            <p class="sub-text">ระบุรหัสผ่านใหม่ที่คุณต้องการใช้งาน</p>
            
            <form id="resetPasswordForm">
                <div class="form-group">
                    <label for="newPassword">รหัสผ่านใหม่ <span style="color:red">*</span></label>
                    <input type="password" id="newPassword" class="form-input" placeholder="รหัสผ่านใหม่" required>
                </div>

                <div class="form-group">
                    <label for="confirmNewPassword">ยืนยันรหัสผ่านใหม่ <span style="color:red">*</span></label>
                    <input type="password" id="confirmNewPassword" class="form-input" placeholder="กรอกรหัสผ่านอีกครั้ง" required>
                </div>

                <button type="submit" class="btn-login" style="margin-top: 10px;">บันทึกรหัสผ่านใหม่</button>
            </form>
            <br>
            <a href="sign.html" style="text-decoration: none; color: #666; font-size: 14px;">ยกเลิกและกลับหน้าเข้าสู่ระบบ</a>
        </div>
    </section>

    <script>
        // 1. ดึงค่า email จาก URL (เช่น ?email=test@mail.com)
        const urlParams = new URLSearchParams(window.location.search);
        const userEmail = urlParams.get('email');

        document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            // ตรวจสอบความถูกต้อง
            if (newPassword !== confirmNewPassword) {
                alert("รหัสผ่านไม่ตรงกัน กรุณาตรวจสอบอีกครั้ง");
                return;
            }

            if (newPassword.length < 6) {
                alert("รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัวอักษร");
                return;
            }

            // 2. ดึงข้อมูล user จาก LocalStorage
            const storedUser = JSON.parse(localStorage.getItem('vgUser'));

            // ตรวจสอบว่ามี user ในระบบและอีเมลตรงกับใน URL หรือไม่
            if (storedUser && storedUser.email === userEmail) {
                
                // 3. อัปเดตรหัสผ่านใหม่
                storedUser.password = newPassword;
                localStorage.setItem('vgUser', JSON.stringify(storedUser));

                alert("เปลี่ยนรหัสผ่านสำเร็จแล้ว! กรุณาเข้าสู่ระบบด้วยรหัสผ่านใหม่");
                window.location.href = 'sign.html';
                
            } else {
                alert("เกิดข้อผิดพลาด: ไม่พบข้อมูลบัญชีนี้ในระบบ หรือลิงก์ไม่ถูกต้อง");
            }
        });
    </script>
</body>
</html>
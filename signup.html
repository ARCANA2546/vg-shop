<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สมัครสมาชิก - VG SHOP</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("ec8yJSGmW3AwGLnR4"); // ใส่ Public Key ของคุณตรงนี้
        })();
    </script>
</head>
<body>

    <header class="site-header">
        <div class="container">
            <div class="header-layout">
                <div class="logo-area">
                    <a href="homepage.html" class="brand-logo">VG SHOP</a>
                </div>
                <nav class="center-nav">
                    <ul>
                        <li><a href="homepage.html">หน้าหลัก</a></li>
                        <li><a href="#">ร้านค้า</a></li>
                        <li><a href="#">การ์ด</a></li>
                        <li><a href="#">เด็ค</a></li>
                    </ul>
                </nav>
                <div class="right-actions"></div>
            </div>
        </div>
    </header>

    <section class="login-section">
        <div class="login-card" style="max-width: 500px;">
            <h2>สมัครสมาชิก</h2>
            <p class="sub-text">สร้างบัญชีเพื่อเริ่มต้นใช้งาน</p>
            
            <form id="signupForm" onsubmit="handleSignup(event)">
                
                <div class="form-group">
                    <label for="username">ชื่อผู้ใช้ (Username) <span style="color:red">*</span></label>
                    <input type="text" id="username" class="form-input" placeholder="ตั้งชื่อผู้ใช้ของคุณ" required>
                </div>

                <div class="form-group">
                    <label for="email">อีเมล <span style="color:red">*</span></label>
                    <div style="display: flex; gap: 10px;">
                        <input type="email" id="email" class="form-input" placeholder="example@email.com" required>
                        <button type="button" id="btnSendCode" onclick="sendOTP()" class="btn-outline" style="white-space: nowrap; padding: 0 20px; font-size: 14px;">ส่งรหัส</button>
                    </div>
                    <small id="emailHelp" style="color: #666; font-size: 12px; display: none;">รหัสถูกส่งไปยังอีเมลแล้ว</small>
                </div>

                <div class="form-group">
                    <label for="verifyCode">รหัสยืนยัน (จากอีเมล) <span style="color:red">*</span></label>
                    <input type="text" id="verifyCode" class="form-input" placeholder="กรอกรหัส 6 หลัก" maxlength="6" required>
                </div>
                
                <div class="form-group">
                    <label for="password">รหัสผ่าน <span style="color:red">*</span></label>
                    <input type="password" id="password" class="form-input" placeholder="กำหนดรหัสผ่าน" required>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">ยืนยันรหัสผ่าน <span style="color:red">*</span></label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="กรอกรหัสผ่านอีกครั้ง" required>
                </div>

                <button type="submit" class="btn-login" style="margin-top: 20px;">ยืนยันการสมัคร</button>
            </form>

            <div class="divider">
                <span>มีบัญชีอยู่แล้ว?</span>
            </div>

            <a href="sign.html" style="text-decoration: none;">
                <button type="button" class="btn-register">เข้าสู่ระบบ</button>
            </a>
        </div>
    </section>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-layout">
                <div class="footer-left">
                    <h2>VG SHOP</h2>
                    <p>ศูนย์รวมการ์ดเกมที่ครบวงจรที่สุด</p>
                </div>
                <div class="footer-right">
                    <p>&copy; 2024 VG Shop. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <div id="successModal" class="modal-overlay">
        <div class="modal-box">
            <div class="success-checkmark">
                <div class="check-icon">
                    <span class="icon-line line-tip"></span>
                    <span class="icon-line line-long"></span>
                    <div class="icon-circle"></div>
                    <div class="icon-fix"></div>
                </div>
            </div>
            <h3>สมัครสมาชิกเรียบร้อย!</h3>
            <p>ระบบจะพาคุณไปหน้าเข้าสู่ระบบใน <span id="countdownTimer" style="font-weight:bold; color:#000;">3</span> วินาที...</p>
            <button class="btn-login" onclick="closeModal()" style="margin-top: 20px; width: auto; padding-left: 30px; padding-right: 30px;">ไปหน้าเข้าสู่ระบบทันที</button>
        </div>
    </div>

    <script>
        function sendOTP() {
        const emailInput = document.getElementById('email');
        const btnSend = document.getElementById('btnSendCode');
        const emailHelp = document.getElementById('emailHelp');

        if (!emailInput.value) {
            alert("กรุณากรอกอีเมลก่อนกดส่งรหัส");
            emailInput.focus();
            return;
        }

        // สุ่มรหัส 6 หลัก
        generatedOTP = Math.floor(100000 + Math.random() * 900000);

        // แสดงสถานะการส่ง
        btnSend.innerText = "กำลังส่ง...";
        btnSend.disabled = true;

        // เตรียมข้อมูลส่งไป EmailJS
        const templateParams = {
            user_email: emailInput.value,    // ชื่อนี้ต้องตรงกับ {{user_email}} ใน To Email ของ EmailJS
            to_email: emailInput.value,      // เพิ่มไว้เผื่อในระบบตั้งเป็น {{to_email}}
            otp_code: generatedOTP           // ชื่อนี้ต้องตรงกับ {{otp_code}} ในเนื้อหาอีเมล
        };

        emailjs.send('service_v7ku20q', 'template_bqbbmxo', templateParams)
            .then(function(response) {
                console.log('SUCCESS!', response.status, response.text);
                alert(`รหัสยืนยันถูกส่งไปยัง ${emailInput.value} เรียบร้อยแล้ว!`);
                
                btnSend.innerText = "ส่งอีกครั้ง";
                btnSend.disabled = false;
                emailHelp.style.display = 'block';
                emailHelp.innerText = `รหัสยืนยันถูกส่งไปที่ ${emailInput.value} แล้ว`;
                emailHelp.style.color = 'green';
            }, function(error) {
                console.log('FAILED...', error);
                alert("เกิดข้อผิดพลาดในการส่งอีเมล: " + JSON.stringify(error));
                btnSend.innerText = "ส่งรหัส";
                btnSend.disabled = false;
            });
        }

        // ฟังก์ชันตรวจสอบตอนกดสมัครสมาชิก
        function handleSignup(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const inputOTP = document.getElementById('verifyCode').value;

            if (!generatedOTP) {
                alert("กรุณากดปุ่ม 'ส่งรหัส' และกรอกรหัสยืนยันทางอีเมลก่อน");
                return;
            }

            if (inputOTP != generatedOTP) {
                alert("รหัสยืนยันไม่ถูกต้อง"); 
                return;
            }

            if (password !== confirmPassword) {
                alert("รหัสผ่านไม่ตรงกัน"); 
                return;
            }

            // บันทึกข้อมูลจำลองลงเครื่อง
            const userData = {
                username: username,
                email: email,
                password: password
            };
            localStorage.setItem('vgUser', JSON.stringify(userData));

            // แสดง Modal สำเร็จ
            const modal = document.getElementById('successModal');
            modal.style.display = 'flex'; 

            // --- ส่วนนับถอยหลัง (Countdown) ---
            let timeLeft = 3; // ตั้งเวลาเริ่มต้น 3 วินาที
            const timerElement = document.getElementById('countdownTimer');
            
            // อัปเดตตัวเลขทุกๆ 1 วินาที
            const countdownInterval = setInterval(() => {
                timeLeft--; // ลดเวลาลงทีละ 1
                timerElement.innerText = timeLeft; // แสดงผลตัวเลขใหม่

                if (timeLeft <= 0) {
                    clearInterval(countdownInterval); // หยุดตัวนับ
                    window.location.href = 'sign.html'; // ย้ายหน้า
                }
            }, 1000); // 1000ms = 1 วินาที
        }

        function closeModal() {
            window.location.href = 'sign.html';
        }
    </script>

</body>
</html>